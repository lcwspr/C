# 文件操作
## 概述
1. 磁盘文件和设备文件
    * 磁盘文件
        * 指一组相关数据的有序集合，通常存储在外部介质(磁盘)，使用时才调入内存。
    * 设备文件
        * 在操作系统中把每一个与主机相连的输入，输出设备看作是一个文件，把他们的输入，输出等同于磁盘文件的读和写。

2. 磁盘文件的分类
    * 计算机的存储在物理上上二进制，所以物理上所有的磁盘文件本质上都是一样的，以字节为单位进行顺寻存储
    * 从用户或者操作系统使用的角度(逻辑上)把文件分为
        * 文本文件： 基于字符编码的文件
        * 二进制文件： 基于值编码的文件

3. 文本文件和二进制文件
    1. 文本文件
        * 基于字符编码，常见编码由ASCII，unicode
        * 一般可以使用文本编辑器直接打开
    2. 二进制文件
        * 基于值编码，自己根据具体应用，指定某个值是什么意思
        * 把内存中的数据按其在内存中的存储形式原样输出到磁盘上
        * 数5678的存储形式(二进制码)为00010110 00101110

## 文件的打开和关系
1. 在C语言中用一个指针变量指向一个文件，这个指针称为文件指针。
    ```
    typedef struct
    {
        short level;            // 缓冲区满或空的程度
        unsigned flags;         // 文件状态标志
        char fd;                // 文件描述符
        unsigned char hold;     // 如无缓冲区不读取字符
        short bsize;            // 缓冲区大小
        unsigned char * buffer; // 数据缓区位置
        unsigned ar;            // 指针，当前的指向
        unsigned istemp;        // 临时文件，指示器
        short token;            // 用于有效性检查
    }
    ```
    * FILE是系统使用typedef定义出来的有关文件信息的一种结构体类型，结构体中含有文件名，文件状态和文件当前位置等信息。
    * 声明FILE结构体类型的信息包含在头文件stdio.h中，一般设置一个指向FILE类型变量的指针变量，然后通过他来引用这些FILE类型变量。通过文件指针就可以对他所指的文件进行各种操作。
    * C语言中有三个特殊的文件指针由系统默认打开，无需定义就可以使用
        * stdin 标准输入，默认为当前终端(键盘)，我们使用的scanf,getchar函数默认从此终端获得数据。
        * stdout 标准输出，默认为当前终端(屏幕)，我们使用的printf,puts函数默认输出信息到此终端
        * stderr 标准出错，默认为当前终端(屏幕)，我们使用的perror函数默认输出信息到此终端。


## 文件的打开
1. 任何文件使用之前必须打开
* fopen 函数说明
    * 头文件 `#include <stdio.h>`
    * 原型： `FILE * fopen(const char * filename, const char * mode);`
    * 功能： 打开文件
    * 参数：
        * filename： 需要打开的文件名，跟需要加上路径
        * mode: 打开文件的模式设置
    * 返回值
        * 成功： 文件指针
        * 失败： NULL
* fopen函数参数介绍
    1. 第一个参数几种形式
        * 相对路径
            1. 打开当前目录passwd文件： 源文件(源程序)所在目录
                `FILE * fp_passwd = fopen("passwd.txt","r");`
            2. 打开当前目录下test下passwd.txt文件
                `FILE * fp_passwd = fopen("./test/passwd.txt","r");`
            3. 打开当前目录上一级目录(相对当前目录)passwd.txt文件
                `FILE * fp_passwd = fopen("../passwd.txt", "r");`
        * 绝对路径
            1. 打开C盘下passwd.txt
                `FILE * fp_passwd = fopen("c://test/passwd.txt","r");`
    2. 第二个参数的几种形式(打开文件的方式)
        * r或rb: 以只读方式打开一个文本文件(不创建文件，若文件不存在报错)
        * w或wb: 以写的方式打开文件(如果文件存在则清空，文件不存在创建一个文件)
        * a或ab: 以追加方式打开文件，在末尾添加内容，若文件不存在则创建文件
        * r+或rb+: 以可读，可写方式打开文件，不创建新文件
        * w+或wb+: 以可读，可写的方式打开文件(如果文件存在则清空文件，不存在则创建一个文件)
        * a+或ab+: 以添加方式打开文件，打开文件并在末尾更改文件，若文件不存在则创建文件
    3. 注意
        * b是二进制模式b只是在windows有效，Linux用r和rb结果一样
        * unix和Linux下所有的文本文件行都是\n结尾的，而Windows所有的文本文件行都是\r\n结尾的
        * windows下，以文本方式打开文件，不加b
            * 当读取文件时，系统会将所有的\r\n转换为\n
            * 当写入文件时，系统将所有\n转换成\r\n写入
            * 以二进制方式打开文件，则读或写都不会进行这样的转换
        * unix/Linux,文本与二进制模式没有区别，\r\n作为两个字符原样输入输出
    4. 路径问题
        * 双反斜杠的路径形式，只能在windows使用，斜杠的路径形式，windows和Linux都可以使用，路径可以是相对路径也能是绝对路径。

## 文件的关闭
1. 任何文件在使用后都应该关闭
    * 打开的文件会占用内存资源，如果总是打开不关闭，会消耗很多内存
    * 一个进程同时打开的文件数是有限制的，超过最大同时打开文件数，再次调用fopen打开文件会失败
    * 如果没有明确的调用fclose关闭打开的文件，那么程序在退出的时候，操作会统一关闭
2. fclose()
    1. 头文件 `#include <stdio.h>`
    2. 原型 `int fclose(FILE * stream);`
    3. 功能： 关闭先前fopen()打开的文件，此动作让缓冲区的数据写入文件，并释放系统所提供的文件资源。
    4. 参数
        * stream: 文件指针
    5. 返回值
        * 成功 0
        * 失败 -1

## 文件的顺序读写
1. 写文件
    * 头文件: `#include <stdio.h>`
    * 原型: `int fputc(int ch, FILE * stream);`
    * 功能： 将ch转换为unsigned char 后写入stream指定的文件中
    * 参数
        * ch需要写入文件的字符
        * 失败返回-1
2. 文件结尾
    * 在C语言中，EOF表示文件结束符(end of file)。在while循环中以EOF作为文件结束标志，这种以EOF作为文件结束标志的文件，必须是文本文件。在文本文件中，数据都是以字符的ASCII代码值的形式存放。我们知道，ASCII代码值的范围是0~127，不可能出现-1，因此可以用EOF作为文件结束标志。`#define EOF (-1)`
    * 当把数据以二进制形式存放到文件中时，就会有-1值的出现，因此不能采用EOF作为二进制文件的结束标志。为解决这一个问题，ANSI C提供一个feof函数，用来判断文件是否结束。feof函数既可用以判断二进制文件又可用以判断文本文件。
    * feof()函数
        * 头文件： `#include <stdio.h>`
        * 函数原型： `int feof(FILE * stream);`
        * 功能： 检测是否读取到了文件结尾，判断的是最后一次的读操作内容，不是当前位置内容。(依据内容判断就是会多走出一段距离才能判断)
        * 参数： stream 文件指针
        * 返回值
            * 非0值，到达文件尾部
            * 0没有到文件尾

## 读文件
1. fgetc函数
    * 头文件： `#include <stdio.h>`
    * 原型:  `int fgetc(FILE * stream);`
    * 功能： 从stream指定的文件读取一个字符
    * 参数： stream文件指针
    * 返回值： 成功: 返回读取到的字符，失败 -1

2. 例子
    ```
    // way 1
    char ch;
    while ((ch = fgetc(fp)) != EOF)
    {
        printf("%c", ch);
    }
    
    // way 2
    while (!feof(fp)) //文件没有结束，则执行循环
    {
        ch = fgetc(fp);
        printf("%c", ch);
    }
    ```
    